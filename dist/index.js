"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("camelcase-keys"),e=require("cross-fetch"),n=require("util"),r=require("os"),i=require("fs"),o=require("uuid"),u=require("form-data"),a=require("path-to-regexp"),s=require("ts-mixer");function c(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var d=c(t),f=c(e),l=c(n),p=c(r),h=c(i),m=c(u),v=function(t,e){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},v(t,e)};function g(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}v(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var b,y,w,_,x,A,R=function(){return R=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},R.apply(this,arguments)};function E(t,e,n,r){return new(n||(n=Promise))((function(i,o){function u(t){try{s(r.next(t))}catch(t){o(t)}}function a(t){try{s(r.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,a)}s((r=r.apply(t,e||[])).next())}))}function k(t,e){var n,r,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,r=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(i=u.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=e.call(t,u)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}!function(t){t.accept="Accept",t.authorization="Authorization",t.contentType="Content-Type",t.editframeClientId="Editframe-Client-Id",t.userAgent="User-Agent",t.xRequestedWith="X-Requested-With"}(b||(b={})),function(t){t.bearer="Bearer ",t.editframeJs="editframe.js/",t.xRequestedWithXML="XMLHttpRequest"}(y||(y={})),function(t){t.delete="delete",t.get="get",t.post="post",t.put="put"}(w||(w={})),function(t){t.description="description",t.lastUsedAt="lastUsedAt",t.name="name",t.webhook="webhook"}(_||(_={})),function(t){t.black="#000000",t.transparent="transparent",t.white="#ffffff"}(x||(x={})),function(t){t.backgroundColor="backgroundColor",t.color="color",t.data="data",t.end="end",t.filter="filter",t.fontFamily="fontFamily",t.fontSize="fontSize",t.fontWeight="fontWeight",t.format="format",t.height="height",t.horizontalAlignment="horizontalAlignment",t.id="id",t.length="length",t.lineHeight="lineHeight",t.maxFontSize="maxFontSize",t.maxHeight="maxHeight",t.maxWidth="maxWidth",t.start="start",t.style="style",t.text="text",t.textAlign="textAlign",t.trim="trim",t.type="type",t.verticalAlignment="verticalAlignment",t.volume="volume",t.width="width",t.x="x",t.y="y"}(A||(A={}));var F,O,j,T={center:"center",left:"left",right:"right"},C={bottom:"bottom",middle:"middle",top:"top"},M={center:"center",justify:"justify",left:"left",right:"right"},q={bars:"bars",bricks:"bricks",curve:"curve",equalizer:"equalizer",line:"line",pixel:"pixel",roundBars:"roundBars",wave:"wave"},S={brightness:"brightness",contrast:"contrast",fadeIn:"fadein",fadeOut:"fadeout",grayscale:"grayscale",lighten:"lighten",negative:"negative",saturation:"saturation",sobel:"sobel",vintage:"vintage"};!function(t){t.brightness="brightness",t.color="color",t.contrast="contrast",t.duration="duration",t.saturation="saturation"}(F||(F={})),function(t){t.number="number",t.object="object",t.string="string",t[void 0]="undefined"}(O||(O={})),function(t){t.json="application/json"}(j||(j={}));var z,L,W,I,B,H,P,D,N,G={all:"/applications",get:"/applications/:id"},V="/metadata",Y={all:"/videos",create:"/videos",get:"/video/:id"};!function(t){t.setMuted="setMuted",t.setVolume="setVolume"}(z||(z={})),function(t){t.addAudio="addAudio",t.addFilter="addFilter",t.addImage="addImage",t.addLottie="addLottie",t.addText="addText",t.addVideo="addVideo",t.addWaveform="addWaveform",t.backgroundColor="backgroundColor",t.dimensions="dimensions",t.duration="duration",t.encode="encode",t.layer="layer",t.layers="layers",t.metadata="metadata",t.setLayer="setLayer",t.updateLayerAttribute="updateLayerAttribute"}(L||(L={})),function(t){t.backgroundColor="backgroundColor",t.dimensions="dimensions",t.duration="duration",t.metadata="metadata"}(W||(W={})),function(t){t.id="id",t.status="status",t.timestamp="timestamp"}(I||(I={}));var U,X,J,$,K,Q,Z,tt,et,nt,rt,it,ot,ut,at,st=((B={})[S.brightness]=((H={})[F.brightness]=O.number,H),B[S.contrast]=((P={})[F.contrast]=O.number,P),B[S.fadeIn]=((D={})[F.color]=O.string,D[F.duration]=O.number,D),B[S.saturation]=((N={})[F.saturation]=O.number,N),B);!function(t){t.filterName="filterName",t.options="options"}(U||(U={})),function(t){t.setFilter="setFilter"}(X||(X={})),function(t){t.setLength="setLength",t.setStart="setStart"}(J||(J={})),function(t){t.audio="audio",t.filter="filter",t.image="image",t.lottie="lottie",t.text="text",t.video="video",t.waveform="waveform"}($||($={})),function(t){t.fill="fill",t.fit="fit",t.stretch="stretch"}(K||(K={})),function(t){t.setAnimationData="setAnimationData"}(Q||(Q={})),function(t){t.setTrim="setTrim"}(Z||(Z={})),function(t){t.setFontFamily="setFontFamily",t.setFontSize="setFontSize",t.setFontWeight="setFontWeight",t.setLineHeight="setLineHeight",t.setMaxFontSize="setMaxFontSize",t.setMaxHeight="setMaxHeight",t.setMaxWidth="setMaxWidth",t.setText="setText",t.setTextAlignment="setTextAlignment"}(tt||(tt={})),function(t){t.setDimensions="setDimensions",t.setFilter="setFilter"}(et||(et={})),function(t){t.setBackgroundColor="setBackgroundColor",t.setColor="setColor",t.setFormat="setFormat",t.setHeight="setHeight",t.setWidth="setWidth",t.setX="setX",t.setY="setY"}(nt||(nt={})),function(t){t.downloadUrl="downloadUrl",t.duration="duration",t.isReady="isReady",t.metadata="metadata",t.streamUrl="streamUrl",t.thumbnailUrl="thumbnailUrl",t.timestamp="timestamp"}(rt||(rt={})),function(t){t.all="all",t.get="get",t.getMetadata="_getMetadata",t.new="new"}(it||(it={})),function(t){t.bitrate="bitrate",t.codec="codec",t.duration="duration",t.fps="fps",t.height="height",t.size="size",t.width="width"}(ot||(ot={})),function(t){t.type="type"}(ut||(ut={})),function(t){t.audio="audio",t.image="image",t.video="video"}(at||(at={}));var ct=function(t,e){return"".concat(t," - ").concat(e)},dt=function(t){return"Error getting applications: ".concat(t)},ft="malformed `applications` response";function lt(t,e){return t(e={exports:{}},e.exports),e.exports}var pt=lt((function(t){var e={};t.exports=e;var n={reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29],black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39],grey:[90,39],brightRed:[91,39],brightGreen:[92,39],brightYellow:[93,39],brightBlue:[94,39],brightMagenta:[95,39],brightCyan:[96,39],brightWhite:[97,39],bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgGray:[100,49],bgGrey:[100,49],bgBrightRed:[101,49],bgBrightGreen:[102,49],bgBrightYellow:[103,49],bgBrightBlue:[104,49],bgBrightMagenta:[105,49],bgBrightCyan:[106,49],bgBrightWhite:[107,49],blackBG:[40,49],redBG:[41,49],greenBG:[42,49],yellowBG:[43,49],blueBG:[44,49],magentaBG:[45,49],cyanBG:[46,49],whiteBG:[47,49]};Object.keys(n).forEach((function(t){var r=n[t],i=e[t]=[];i.open="["+r[0]+"m",i.close="["+r[1]+"m"}))})),ht=function(t,e){var n=(e=e||process.argv).indexOf("--"),r=/^-{1,2}/.test(t)?"":"--",i=e.indexOf(r+t);return-1!==i&&(-1===n||i<n)},mt=process.env,vt=void 0;function gt(t){var e=function(t){if(!1===vt)return 0;if(ht("color=16m")||ht("color=full")||ht("color=truecolor"))return 3;if(ht("color=256"))return 2;if(t&&!t.isTTY&&!0!==vt)return 0;var e=vt?1:0;if("win32"===process.platform){var n=p.default.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(n[0])>=10&&Number(n[2])>=10586?Number(n[2])>=14931?3:2:1}if("CI"in mt)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some((function(t){return t in mt}))||"codeship"===mt.CI_NAME?1:e;if("TEAMCITY_VERSION"in mt)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(mt.TEAMCITY_VERSION)?1:0;if("TERM_PROGRAM"in mt){var r=parseInt((mt.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(mt.TERM_PROGRAM){case"iTerm.app":return r>=3?3:2;case"Hyper":return 3;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(mt.TERM)?2:/^screen|^xterm|^vt100|^rxvt|color|ansi|cygwin|linux/i.test(mt.TERM)||"COLORTERM"in mt?1:(mt.TERM,e)}(t);return function(t){return 0!==t&&{level:t,hasBasic:!0,has256:t>=2,has16m:t>=3}}(e)}ht("no-color")||ht("no-colors")||ht("color=false")?vt=!1:(ht("color")||ht("colors")||ht("color=true")||ht("color=always"))&&(vt=!0),"FORCE_COLOR"in mt&&(vt=0===mt.FORCE_COLOR.length||0!==parseInt(mt.FORCE_COLOR,10));var bt,yt=gt,wt=(gt(process.stdout),gt(process.stderr),lt((function(t){t.exports=function(t,e){var n="";t=(t=t||"Run the trap, drop the bass").split("");var r={a:["@","ƒÑ","»∫","…Ö","Œî","Œõ","–î"],b:["√ü","∆Å","…É","…Æ","Œ≤","‡∏ø"],c:["¬©","»ª","œæ"],d:["√ê","∆ä","‘Ä","‘Å","‘Ç","‘É"],e:["√ã","ƒï","∆é","…ò","Œ£","Œæ","“º","‡©¨"],f:["”∫"],g:["…¢"],h:["ƒ¶","∆ï","“¢","“∫","”á","‘ä"],i:["‡ºè"],j:["ƒ¥"],k:["ƒ∏","“†","”É","‘û"],l:["ƒπ"],m:[" ç","”ç","”é","‘†","‘°","‡µ©"],n:["√ë","≈ã","∆ù","Õ∂","Œ†","“ä"],o:["√ò","√µ","√∏","«æ"," ò","—∫","◊ù","€ù","‡πè"],p:["«∑","“é"],q:["‡ßç"],r:["¬Æ","∆¶","»ê","…å"," Ä","–Ø"],s:["¬ß","œû","œü","œ®"],t:["≈Å","≈¶","Õ≥"],u:["∆±","’ç"],v:["◊ò"],w:["–®","—†","—º","‡µ∞"],x:["“≤","”æ","”º","”Ω"],y:["¬•","“∞","”ã"],z:["∆µ","…Ä"]};return t.forEach((function(t){t=t.toLowerCase();var e=r[t]||[" "],i=Math.floor(Math.random()*e.length);n+=void 0!==r[t]?r[t][i]:t})),n}}))),_t=lt((function(t){t.exports=function(t,e){t=t||"   he is here   ";var n={up:["Ãç","Ãé","ÃÑ","ÃÖ","Ãø","Ãë","ÃÜ","Ãê","Õí","Õó","Õë","Ãá","Ãà","Ãä","ÕÇ","Ãì","Ãà","Õä","Õã","Õå","ÃÉ","ÃÇ","Ãå","Õê","ÃÄ","ÃÅ","Ãã","Ãè","Ãí","Ãì","Ãî","ÃΩ","Ãâ","Õ£","Õ§","Õ•","Õ¶","Õß","Õ®","Õ©","Õ™","Õ´","Õ¨","Õ≠","ÕÆ","ÕØ","Ãæ","Õõ","ÕÜ","Ãö"],down:["Ãñ","Ãó","Ãò","Ãô","Ãú","Ãù","Ãû","Ãü","Ã†","Ã§","Ã•","Ã¶","Ã©","Ã™","Ã´","Ã¨","Ã≠","ÃÆ","ÃØ","Ã∞","Ã±","Ã≤","Ã≥","Ãπ","Ã∫","Ãª","Ãº","ÕÖ","Õá","Õà","Õâ","Õç","Õé","Õì","Õî","Õï","Õñ","Õô","Õö","Ã£"],mid:["Ãï","Ãõ","ÃÄ","ÃÅ","Õò","Ã°","Ã¢","Ãß","Ã®","Ã¥","Ãµ","Ã∂","Õú","Õù","Õû","Õü","Õ†","Õ¢","Ã∏","Ã∑","Õ°"," “â"]},r=[].concat(n.up,n.down,n.mid);function i(t){return Math.floor(Math.random()*t)}function o(t){var e=!1;return r.filter((function(n){e=n===t})),e}return function(t,e){var r,u,a="";for(u in(e=e||{}).up=void 0===e.up||e.up,e.mid=void 0===e.mid||e.mid,e.down=void 0===e.down||e.down,e.size=void 0!==e.size?e.size:"maxi",t=t.split(""))if(!o(u)){switch(a+=t[u],r={up:0,down:0,mid:0},e.size){case"mini":r.up=i(8),r.mid=i(2),r.down=i(8);break;case"maxi":r.up=i(16)+3,r.mid=i(4)+1,r.down=i(64)+3;break;default:r.up=i(8)+1,r.mid=i(6)/2,r.down=i(8)+1}var s=["up","mid","down"];for(var c in s)for(var d=s[c],f=0;f<=r[d];f++)e[d]&&(a+=n[d][i(n[d].length)])}return a}(t,e)}})),xt=lt((function(t){t.exports=function(t){return function(e,n,r){if(" "===e)return e;switch(n%3){case 0:return t.red(e);case 1:return t.white(e);case 2:return t.blue(e)}}}})),At=lt((function(t){t.exports=function(t){return function(e,n,r){return n%2==0?e:t.inverse(e)}}})),Rt=lt((function(t){t.exports=function(t){var e=["red","yellow","green","blue","magenta"];return function(n,r,i){return" "===n?n:t[e[r++%e.length]](n)}}})),Et=lt((function(t){t.exports=function(t){var e=["underline","inverse","grey","yellow","red","green","blue","white","cyan","magenta","brightYellow","brightRed","brightGreen","brightBlue","brightWhite","brightCyan","brightMagenta"];return function(n,r,i){return" "===n?n:t[e[Math.round(Math.random()*(e.length-2))]](n)}}})),kt=lt((function(t){var e={};t.exports=e,e.themes={};var n=e.styles=pt,r=Object.defineProperties,i=new RegExp(/[\r\n]+/g);e.supportsColor=yt,void 0===e.enabled&&(e.enabled=!1!==e.supportsColor()),e.enable=function(){e.enabled=!0},e.disable=function(){e.enabled=!1},e.stripColors=e.strip=function(t){return(""+t).replace(/\x1B\[\d+m/g,"")},e.stylize=function(t,r){if(!e.enabled)return t+"";var i=n[r];return!i&&r in e?e[r](t):i.open+t+i.close};var o=/[|\\{}()[\]^$+*?.]/g;function u(t){var e=function t(){return d.apply(t,arguments)};return e._styles=t,e.__proto__=c,e}var a,s=(a={},n.grey=n.gray,Object.keys(n).forEach((function(t){n[t].closeRe=new RegExp(function(t){if("string"!=typeof t)throw new TypeError("Expected a string");return t.replace(o,"\\$&")}(n[t].close),"g"),a[t]={get:function(){return u(this._styles.concat(t))}}})),a),c=r((function(){}),s);function d(){var t=Array.prototype.slice.call(arguments),r=t.map((function(t){return null!=t&&t.constructor===String?t:l.default.inspect(t)})).join(" ");if(!e.enabled||!r)return r;for(var o=-1!=r.indexOf("\n"),u=this._styles,a=u.length;a--;){var s=n[u[a]];r=s.open+r.replace(s.closeRe,s.open)+s.close,o&&(r=r.replace(i,(function(t){return s.close+t+s.open})))}return r}e.setTheme=function(t){if("string"!=typeof t)for(var n in t)!function(n){e[n]=function(r){if("object"==typeof t[n]){var i=r;for(var o in t[n])i=e[t[n][o]](i);return i}return e[t[n]](r)}}(n);else console.log("colors.setTheme now only accepts an object, not a string.  If you are trying to set a theme from a file, it is now your (the caller's) responsibility to require the file.  The old syntax looked like colors.setTheme(__dirname + '/../themes/generic-logging.js'); The new syntax looks like colors.setTheme(require(__dirname + '/../themes/generic-logging.js'));")};var f=function(t,e){var n=e.split("");return(n=n.map(t)).join("")};for(var p in e.trap=wt,e.zalgo=_t,e.maps={},e.maps.america=xt(e),e.maps.zebra=At(e),e.maps.rainbow=Rt(e),e.maps.random=Et(e),e.maps)!function(t){e[t]=function(n){return f(e.maps[t],n)}}(p);r(e,function(){var t={};return Object.keys(s).forEach((function(e){t[e]={get:function(){return u([e])}}})),t}())})),Ft=lt((function(t){t.exports=kt})),Ot={clientIdAndTokenRequired:"\\".concat(Ft.white("clientId"),"\\ and \\").concat(Ft.white("token"),"\\ must be provided to constructor")},jt=function(t){return"\\".concat(Ft.white(t),"\\ is not valid url")},Tt=function(t,e,n,r){return"\n  \\".concat(Ft.white(e),"\\ attribute in \\").concat(Ft.white(t),"\\ must be of type \\").concat(Ft.white(r),"\\. Got: \\").concat(Ft.white(JSON.stringify(n)),"\\")},Ct=function(t){return t.join(" | ")},Mt=function(t){return"\\".concat(Ft.white(t),"\\ field is required")},qt=function(t,e){return"".concat(t,": { ").concat(e," }")},St={dataRequired:"\\".concat(Ft.white("data"),"\\ must be provided"),dimensionsRequired:"\\".concat(Ft.white("dimensions"),"\\ must be provided unless a \\").concat(Ft.white("videoFile"),"\\ is provided"),durationRequired:"\\".concat(Ft.white("duration"),"\\ must be provided unless a \\").concat(Ft.white("videoFile"),"\\ is provided"),errorEncoding:function(t){return"Error encoding video: ".concat(t)},filterRequired:"\\".concat(Ft.white("filter"),"\\ must be provided"),malformedEncodingResponse:"malformed ".concat(Ft.white("encoding"),"\\ response"),optionsRequired:"\\".concat(Ft.white("options"),"\\ must be provided"),textRequired:"\\".concat(Ft.white("text"),"\\ field required"),validationOptionsError:function(t){return"Error: ".concat(t)}},zt="Invalid file source provided",Lt=function(t){return"Invalid layer format: ".concat(t)},Wt=function(t){return"Error getting videos: ".concat(t)},It=function(t){return"Error getting video: ".concat(t)},Bt="malformed `videos` response",Ht=function(t){return"Error creating new video: ".concat(t)},Pt=function(t,e){return"".concat(t,"/v").concat(e)},Dt=function(t){return function(e){return e.url.startsWith("/")?f.default("".concat(t).concat(e.url),e):f.default(e.url,e)}},Nt=function(t){return function(e){var n=e.data,r=e.headers,i=e.method,o=e.url;return E(void 0,void 0,void 0,(function(){var e,u,a;return k(this,(function(s){switch(s.label){case 0:return[4,t({body:n,headers:r,method:i,url:o})];case 1:if(!(e=s.sent()).ok)throw new Error(ct(e.url,e.statusText));return[4,e.json()];case 2:return u=s.sent(),(a=d.default(u,{deep:!0})).data?[2,a.data]:[2,a]}}))}))}},Gt=function(t){var e,n=t.clientId,r=t.isForm,i=void 0!==r&&r,o=t.token,u=((e={})[b.userAgent]="".concat(y.editframeJs).concat("0.2.4"),e[b.editframeClientId]=n,e[b.authorization]="".concat(y.bearer).concat(o),e);return i?(u[b.accept]=j.json,u[b.xRequestedWith]=y.xRequestedWithXML):u[b.contentType]=j.json,u},Vt=function(t,e){if(t&&e.validate(t))return t;throw new Error(e.invalidDataError)},Yt=function(t){return _.description in t&&_.lastUsedAt in t&&_.name in t&&_.webhook in t},Ut=function(t){return Yt(t[0])},Xt=function(t){return console.error(Ft.yellow(t))},Jt=function(){return o.v4().slice(0,6)},$t=function(t){return h.default.createReadStream(t)},Kt=function(t){return E(void 0,void 0,void 0,(function(){var n,r,o,u;return k(this,(function(a){switch(a.label){case 0:return n="./tmp/".concat(Jt()),r="".concat(n,"/").concat(Jt()),s=n,i.existsSync(s)||i.mkdirSync(s,{recursive:!0}),[4,e.fetch(t)];case 1:return o=a.sent(),u=i.createWriteStream(r),[4,new Promise((function(t,e){o.body.pipe(u),o.body.on("error",e),u.on("finish",t)}))];case 2:return a.sent(),[2,{temporaryFileDirectory:n,temporaryFilePath:r}]}var s}))}))},Qt=function(t){return typeof t===O.string?"url":"file"},Zt=function(t,e){return void 0===t&&(t="/"),void 0===e&&(e={}),"/"===t?t:function(t){return a.compile(t)}(t)(e,{pretty:!0})},te=function(t){try{new URL(t)}catch(e){throw new TypeError(jt(t))}},ee=function(t,e){if(!t)throw new Error(e)},ne=function(t,e,n,r,i){if(void 0===i&&(i=!1),n&&typeof n!==r){var o=Tt(t,e,n,r);if(i)throw new TypeError(o);return o}},re=function(t,e){try{return t(),e?e():void 0}catch(t){t.name;var n=t.stack;Xt(n),process.exit(1)}},ie=((bt={})[S.brightness]=function(t){return t&&1===Object.keys(t).length&&F.brightness in t},bt[S.contrast]=function(t){return t&&1===Object.keys(t).length&&F.contrast in t},bt[S.fadeIn]=function(t){return t&&2===Object.keys(t).length&&F.color in t&&F.duration in t},bt[S.saturation]=function(t){return t&&1===Object.keys(t).length&&F.saturation in t},bt),oe=function(t,e,n,r){var i=n.filterName,o=n.options;void 0===r&&(r=!1);var u=[],a=Object.values(S).includes(i);if(!a){var s=Tt(t,qt(e,U.filterName),i,"".concat(Object.values(S).join(", ")));if(r)throw new TypeError(s);u.push(s)}if(a&&i in st&&!ie[i](o)){s=Tt(t,qt(e,U.options),o,JSON.stringify(st[i]));if(r)throw new TypeError(s);u.push(s)}return u},ue=function(t){return void 0!==t},ae=function(t,e){var n=e.horizontalAlignment,r=e.verticalAlignment,i=[],o=Object.values(C);return i.push(fe(t,A.horizontalAlignment,n)),r&&!o.includes(r)&&i.push(Tt(t,A.verticalAlignment,r,o.join(", "))),i.filter(ue)},se=function(t,e){var n=[];return n.push(ne(t,A.volume,e.volume,O.number)),n.filter(ue)},ce=function(t,e){var n=e.length,r=e.start,i=[];return i.push(ne(t,A.start,r,O.number)),i.push(ne(t,A.length,n,O.number)),i.filter(ue)},de=function(t,e){var n=e.filter,r=[];return oe(t,A.filter,n).forEach((function(t){return r.push(t)})),r.filter(ue)},fe=function(t,e,n){var r=Object.values(T);if(n&&!r.includes(n))return Tt(t,e,n,r.join(", "))},le=function(t,e){var n=Object.values(M);if(e&&!n.includes(e))return Tt(t,A.textAlign,e,n.join(", "))},pe=function(t,e){var n=e.data,r=[];return r.push(ne(t,A.data,n,O.object)),r.filter(ue)},he=function(t,e){var n=e.fontFamily,r=e.fontSize,i=e.maxFontSize,o=e.maxHeight,u=e.maxWidth,a=e.text,s=e.textAlign,c=[];return c.push(ne(t,A.fontFamily,n,O.string)),c.push(ne(t,A.fontSize,r,O.number)),c.push(ne(t,A.maxFontSize,i,O.number)),c.push(ne(t,A.maxHeight,o,O.number)),c.push(ne(t,A.maxWidth,u,O.number)),c.push(ne(t,A.text,a,O.string)),c.push(le(t,s)),c.filter(ue)},me=function(t,e){var n=e.trim,r=[];return r.push(ne(t,qt(A.trim,A.start),null==n?void 0:n.start,O.number)),r.push(ne(t,qt(A.trim,A.end),null==n?void 0:n.end,O.number)),r.filter(ue)},ve=function(t,e){var n=e.backgroundColor,r=e.color,i=e.x,o=e.y,u=[];return u.push(ne(t,A.backgroundColor,n,O.string)),u.push(ne(t,A.color,r,O.string)),u.push(ne(t,A.x,i,O.number)),u.push(ne(t,A.y,o,O.number)),u.filter(ue)},ge=function(t,e){var n=e.style,r=[];r.push(ne(t,A.style,n,O.string));var i=Object.values(q);return n&&!i.includes(n)&&r.push(Tt(t,A.style,n,i.join(", "))),r.filter(ue)},be=function(t,e,n){var r=t.map((function(t){return t(e,n)})).flat().filter((function(t){return void 0!==t}));if(r.length)throw new TypeError("Validation Errors: ".concat(r.join("\n")))},ye=function(t){return I.id in t&&I.status in t&&I.timestamp in t},we=function(t){return rt.isReady in t&&rt.metadata in t&&rt.timestamp in t},_e=function(t){return we(t[0])},xe=function(t){return ot.bitrate in t&&ot.codec in t&&ot.duration in t&&ot.fps in t&&ot.height in t&&ot.size in t&&ot.width in t},Ae=function(){function t(t){this._options=R({},t),this._fetch=t.fetch}return t.prototype.get=function(t){var e=t.url;return E(this,void 0,void 0,(function(){return k(this,(function(t){switch(t.label){case 0:return[4,this._fetch({headers:Gt(this._options),url:e})];case 1:return[2,t.sent()]}}))}))},t.prototype.post=function(t){var e=t.data,n=t.isForm,r=void 0!==n&&n,i=t.url;return E(this,void 0,void 0,(function(){return k(this,(function(t){switch(t.label){case 0:return[4,this._fetch({data:e,headers:Gt(R(R({},this._options),{isForm:r})),method:w.post,url:i})];case 1:return[2,t.sent()]}}))}))},t.prototype.put=function(t){var e=t.data,n=t.isForm,r=void 0!==n&&n,i=t.url;return E(this,void 0,void 0,(function(){return k(this,(function(t){switch(t.label){case 0:return[4,this._fetch({data:e,headers:Gt(R(R({},this._options),{isForm:r})),method:w.put,url:i})];case 1:return[2,t.sent()]}}))}))},t}(),Re=function(){function t(t){this._api=t}return t.prototype.all=function(){return E(this,void 0,void 0,(function(){var t,e;return k(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this._api.get({url:G.all})];case 1:return t=n.sent(),[2,Vt(t,{invalidDataError:ft,validate:Ut})];case 2:return e=n.sent(),console.error(dt(e.message)),[3,3];case 3:return[2,[]]}}))}))},t.prototype.get=function(t){return E(this,void 0,void 0,(function(){var e,n;return k(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._api.get({url:Zt(G.get,{id:t})})];case 1:return e=r.sent(),[2,Vt(e,{invalidDataError:ft,validate:Yt})];case 2:return n=r.sent(),console.error(dt(n.message)),[3,3];case 3:return[2,void 0]}}))}))},t}(),Ee=function(){function t(t){var e=t.composition,n=t.id;this._composition=e,this._id=n}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),t.prototype[J.setStart]=function(t){var e=this;return re((function(){return ne(J.setStart,A.start,t,O.number,!0)}),(function(){return e._updateAttribute(A.start,t)}))},t.prototype[J.setLength]=function(t){var e=this;return re((function(){return ne(J.setLength,A.length,t,O.number,!0)}),(function(){return e._updateAttribute(A.length,t)}))},t.prototype._updateAttribute=function(t,e){return this._composition.updateLayerAttribute(this._id,t,e),this},t}(),ke=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return g(e,t),e.prototype[Z.setTrim]=function(t){var e=this,n=t.end,r=t.start;re((function(){ee(r,Mt(A.start)),ne(Z.setTrim,A.start,r,O.number,!0),ne(Z.setTrim,A.end,n,O.number,!0)}),(function(){return e._updateAttribute(A.start,r<0?0:r),n&&e._updateAttribute(A.end,n),e}))},e}(Ee),Fe=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return g(e,t),e.prototype[z.setVolume]=function(t){var e=this;return re((function(){ee(t,Mt(A.volume)),ne(z.setVolume,A.volume,t,O.number,!0)}),(function(){var n=t;return t>1?n=1:t<0&&(n=0),e._updateAttribute(A.volume,n)}))},e.prototype[z.setMuted]=function(){return this._updateAttribute(A.volume,0)},e}(ke),Oe=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return g(e,t),e.prototype[X.setFilter]=function(t){var e=this,n=t.filterName,r=t.options;return re((function(){return oe(X.setFilter,A.filter,{filterName:n,options:r},!0)}),(function(){return e._updateAttribute(A.filter,{filterName:n,options:r})}))},e}(Ee),je=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return g(e,t),e.prototype[nt.setBackgroundColor]=function(t){var e=this;re((function(){return ne(nt.setBackgroundColor,A.backgroundColor,t,O.string,!0)}),(function(){return e._updateAttribute(A.backgroundColor,t)}))},e.prototype[nt.setColor]=function(t){var e=this;re((function(){return ne(nt.setColor,A.color,t,O.string,!0)}),(function(){return e._updateAttribute(A.color,t)}))},e.prototype[nt.setFormat]=function(t){var e=this;re((function(){return function(t){if(!Object.values(K).includes(t))throw new TypeError(Lt(t))}(t)}),(function(){return e._updateAttribute(A.format,t)}))},e.prototype[nt.setHeight]=function(t){var e=this;re((function(){return ne(nt.setHeight,A.height,t,O.number,!0)}),(function(){return e._updateAttribute(A.height,t)}))},e.prototype[nt.setWidth]=function(t){var e=this;re((function(){return ne(nt.setWidth,A.width,t,O.number,!0)}),(function(){return e._updateAttribute(A.width,t)}))},e.prototype[nt.setX]=function(t){var e=this;re((function(){return ne(nt.setX,A.x,t,O.number,!0)}),(function(){return e._updateAttribute(A.x,t)}))},e.prototype[nt.setY]=function(t){var e=this;re((function(){return ne(nt.setY,A.y,t,O.number,!0)}),(function(){return e._updateAttribute(A.y,t)}))},e}(ke),Te=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return g(e,t),e.prototype[Q.setAnimationData]=function(t){try{return ee(t,Mt(A.data)),ne(Q.setAnimationData,A.data,t,O.object),this._updateAttribute(A.data,t)}catch(t){var e=t.stack;Xt(e)}},e}(je),Ce=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return g(e,t),e.prototype[tt.setFontFamily]=function(t){var e=this;return re((function(){return ne(tt.setFontFamily,A.fontFamily,t,O.string,!0)}),(function(){return e._updateAttribute(A.fontFamily,t)}))},e.prototype[tt.setFontSize]=function(t){var e=this;return re((function(){return ne(tt.setFontSize,A.fontSize,t,O.number,!0)}),(function(){return e._updateAttribute(A.fontSize,t)}))},e.prototype[tt.setFontWeight]=function(t){var e=this;return re((function(){return function(t,e,n,r,i){if(void 0===i&&(i=!1),n&&!r.includes(typeof n)){var o=Tt(t,e,n,Ct(r));if(i)throw new TypeError(o);return o}}(tt.setFontWeight,A.fontWeight,t,[O.number,O.string],!0)}),(function(){return e._updateAttribute(A.fontWeight,t)}))},e.prototype[tt.setLineHeight]=function(t){var e=this;return re((function(){return ne(tt.setLineHeight,A.lineHeight,t,O.number,!0)}),(function(){return e._updateAttribute(A.lineHeight,t)}))},e.prototype[tt.setMaxFontSize]=function(t){var e=this;re((function(){return ne(tt.setMaxFontSize,A.maxFontSize,t,O.number,!0)}),(function(){return e._updateAttribute(A.maxFontSize,t)}))},e.prototype[tt.setMaxHeight]=function(t){var e=this;re((function(){return ne(tt.setMaxHeight,A.maxHeight,t,O.number,!0)}),(function(){return e._updateAttribute(A.maxHeight,t)}))},e.prototype[tt.setMaxWidth]=function(t){var e=this;re((function(){return ne(tt.setMaxWidth,A.maxWidth,t,O.number,!0)}),(function(){return e._updateAttribute(A.maxWidth,t)}))},e.prototype[tt.setText]=function(t){var e=this;re((function(){ee(t,St.textRequired),ne(tt.setText,A.text,t,O.string,!0)}),(function(){return e._updateAttribute(A.text,t)}))},e.prototype[tt.setTextAlignment]=function(t){var e=this;re((function(){return le(tt.setTextAlignment,t)}),(function(){return e._updateAttribute(A.textAlign,t)}))},e}(je),Me=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return g(e,t),e.prototype[et.setDimensions]=function(t){var e=this,n=t.height,r=t.width;re((function(){ee(n,Mt(A.height)),ee(r,Mt(A.width))}),(function(){return e._updateAttribute(A.height,n),e._updateAttribute(A.width,r)}))},e.prototype[et.setFilter]=function(t){var e=this,n=t.filterName,r=t.options;re((function(){return oe(et.setFilter,A.filter,{filterName:n,options:r},!0)}),(function(){return e._updateAttribute(A.filter,{filterName:n,options:r})}))},e}(s.Mixin(Fe,je)),qe=function(){function t(t){var e=this,n=t.api,r=t.formData,i=t.options;this._layers=[],this._api=n,this._files=[],this._formData=r,this._options=i,re((function(){return function(t){var e=t.backgroundColor,n=t.dimensions,r=t.duration,i=[];ee(r,St.durationRequired),ee(n,St.dimensionsRequired),i.push(ne(it.new,qt(W.dimensions,A.height),n.height,O.number)),i.push(ne(it.new,qt(W.dimensions,A.width),n.width,O.number)),i.push(ne(it.new,W.backgroundColor,e,O.string));var o=i.filter((function(t){return void 0!==t}));if(o.length)throw new TypeError(o.join("\n"))}(e._options)}))}return Object.defineProperty(t.prototype,L.backgroundColor,{get:function(){return this._options.backgroundColor},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,L.dimensions,{get:function(){return this._options.dimensions},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,L.duration,{get:function(){return this._options.duration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,L.metadata,{get:function(){return this._options.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,L.layers,{get:function(){return this._layers},enumerable:!1,configurable:!0}),t.prototype[L.layer]=function(t){return this._layers.find((function(e){return e.id&&e.id===t}))},t.prototype[L.addAudio]=function(t,e){var n=this;return void 0===e&&(e={}),re((function(){ee(t,zt),ee(e,St.optionsRequired),function(t){be([ce,me,se],L.addAudio,t)}(e)}),(function(){var r=n._addLayer(R({type:$.audio},e)).id;return n._files.push({file:t,id:r}),new Fe({composition:n,id:r})}))},t.prototype[L.addFilter]=function(t){var e=this;return re((function(){ee(t,St.optionsRequired),ee(t.filter,St.filterRequired),function(t){be([ce,de],L.addFilter,t)}(t)}),(function(){var n=e._addLayer(R(R({},t),{type:$.filter})).id;return new Oe({composition:e,id:n})}))},t.prototype[L.addImage]=function(t,e){var n=this;return void 0===e&&(e={}),re((function(){ee(t,zt),ee(e,St.optionsRequired),function(t){be([ce,ve],L.addImage,t)}(e)}),(function(){var r=n._addLayer(R({type:$.image},e)).id;return n._files.push({file:t,id:r}),new Me({composition:n,id:r})}))},t.prototype[L.addLottie]=function(t){var e=this;return re((function(){ee(t,St.optionsRequired),ee(t.data,St.dataRequired),function(t){be([ce,ve,pe],L.addLottie,t)}(t)}),(function(){var n=e._addLayer(R({type:$.lottie},t)).id;return new Te({composition:e,id:n})}))},t.prototype[L.addText]=function(t){var e=this;return re((function(){ee(t,St.optionsRequired),ee(t.text,St.textRequired),function(t){be([ce,ve,ae,he],L.addText,t)}(t)}),(function(){var n=e._addLayer(R({type:$.text},t)).id;return new Ce({composition:e,id:n})}))},t.prototype[L.addVideo]=function(t,e){var n=this;return void 0===e&&(e={}),re((function(){ee(t,zt),ee(e,St.optionsRequired),function(t){be([ce,me,se,ve],L.addVideo,t)}(e)}),(function(){var r=n._addLayer(R({type:$.video},e)).id;return n._files.push({file:t,id:r}),new Me({composition:n,id:r})}))},t.prototype[L.addWaveform]=function(t,e){var n=this;return void 0===t&&(t={}),re((function(){ee(t,St.optionsRequired),function(t){be([ce,ve,ge],L.addWaveform,t);var e=ne(L.addWaveform,A.style,t.style,O.string);if(e)throw new Error(e)}(t)}),(function(){var r=n._addLayer(R({type:$.waveform},t)).id;return e&&n._files.push({file:e,id:r}),new je({composition:n,id:r})}))},t.prototype[L.encode]=function(){return E(this,void 0,void 0,(function(){var t,e;return k(this,(function(n){switch(n.label){case 0:this._generateConfig(),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._api.post({data:this._formData,isForm:!0,url:Y.create})];case 2:return t=n.sent(),[2,Vt(t,{invalidDataError:St.malformedEncodingResponse,validate:ye})];case 3:return e=n.sent(),console.error(St.errorEncoding(e.message)),[2,void 0];case 4:return[2]}}))}))},t.prototype._generateConfig=function(){var t=this;this._files.forEach((function(e){var n=e.file,r=e.id;return t._formData.append(function(t,e){return"".concat(Qt(t)).concat(e)}(n,r),n)})),this._formData.append("config",JSON.stringify(R(R({},this._options),{layers:this._layers})))},t.prototype._addLayer=function(t){var e=R({id:Jt()},t);return this._layers.push(e),e},t.prototype[L.updateLayerAttribute]=function(t,e,n){var r=R({},this.layer(t));r[e]=n,this.setLayer(t,r)},t.prototype[L.setLayer]=function(t,e){var n=function(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}([],this.layers,!0),r=n.findIndex((function(e){return e.id===t}));n[r]=e,this._layers=n},t}(),Se=function(){function t(t){this._api=t}return t.prototype[it.all]=function(){return E(this,void 0,void 0,(function(){var t,e;return k(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this._api.get({url:Y.all})];case 1:return t=n.sent(),[2,Vt(t,{invalidDataError:Bt,validate:_e})];case 2:return e=n.sent(),console.error(Wt(e.message)),[3,3];case 3:return[2,[]]}}))}))},t.prototype[it.get]=function(t){return E(this,void 0,void 0,(function(){var e,n;return k(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._api.get({url:Zt(Y.get,{id:t})})];case 1:return e=r.sent(),[2,Vt(e,{invalidDataError:Bt,validate:we})];case 2:return n=r.sent(),console.error(It(n.message)),[3,3];case 3:return[2,void 0]}}))}))},t.prototype[it.new]=function(t,e){return void 0===t&&(t={backgroundColor:x.black}),E(this,void 0,void 0,(function(){var n,r,o,u,a,s,c,d,f,l,p,h,v,g,b;return k(this,(function(y){switch(y.label){case 0:return y.trys.push([0,7,,8]),n=void 0,e?(r=void 0,o=void 0,u=void 0,function(t){try{return te(t),!0}catch(t){return!1}}(e)?[4,Kt(e)]:[3,2]):[3,5];case 1:return a=y.sent(),s=a.temporaryFileDirectory,c=a.temporaryFilePath,u=s,r=$t(c),o=$t(c),[3,3];case 2:r=$t(e),o=$t(e),y.label=3;case 3:return[4,this._getMetadata(r)];case 4:return d=y.sent(),v=d.duration,f=d.height,l=d.width,(n=new qe({api:this._api,formData:new m.default,options:R(R({},t),{dimensions:{height:f,width:l},duration:v})})).addVideo(o),w=u,i.existsSync(w)&&i.rmdirSync(w,{recursive:!0}),[3,6];case 5:p=t.backgroundColor,h=t.dimensions,v=t.duration,g=t.metadata,n=new qe({api:this._api,formData:new m.default,options:{backgroundColor:p,dimensions:h,duration:v,metadata:g}}),y.label=6;case 6:return[2,n];case 7:return b=y.sent(),console.error(Ht(b.message)),[3,8];case 8:return[2,void 0]}var w}))}))},t.prototype[it.getMetadata]=function(t){return E(this,void 0,void 0,(function(){var e,n;return k(this,(function(r){switch(r.label){case 0:return e=function(t){var e=new m.default;return t.forEach((function(t){e.append(t[0],t[1])})),e}([[Qt(t),t],[ut.type,at.video]]),[4,this._api.post({data:e,isForm:!0,url:V})];case 1:return n=r.sent(),[2,Vt(n,{invalidDataError:Bt,validate:xe})]}}))}))},t}(),ze=function(){function t(t){var e,n=t.clientId,r=t.host,i=void 0===r?"https://api.editframe.com":r,o=t.token,u=t.version,a=void 0===u?2:u;if(!n||!o)throw new Error(Ot.clientIdAndTokenRequired);this._api=new Ae({clientId:n,fetch:(e=Pt(i,a),Nt(Dt(e))),host:i,token:o,version:a}),this._clientId=n,this._host=i,this._token=o,this._version=a,this.applications=new Re(this._api),this.videos=new Se(this._api)}return Object.defineProperty(t.prototype,"clientId",{get:function(){return this._clientId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"host",{get:function(){return this._host},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"token",{get:function(){return this._token},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),t}();exports.Editframe=ze;
//# sourceMappingURL=index.js.map
